<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carlos ‚Ä¢ Asesor√≠a Financiera</title>
  <link rel="stylesheet" href="structure.css" />
  <!-- Chart.js (cargado una sola vez) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

</head>
<body>

  <!-- HEADER + NAV -->
  <header role="banner">
    <div class="container">
      <h1 class="logo">Carlos ‚Ä¢ Asesor√≠a Financiera</h1>
      <button class="nav-toggle" aria-label="Abrir men√∫">‚ò∞</button>
      <nav role="navigation" aria-label="Men√∫ principal">
        <ul>
          <li><a href="#inicio">Inicio</a></li>
          <li><a href="#quien-soy">Qui√©n Soy</a></li>
          <li><a href="#casos-exito">Casos de √âxito</a></li>
          <li><a href="#asesorias">Asesor√≠as</a></li>
          <li><a href="#modelos">Modelos</a></li>
          <li><a href="#test-perfil">Test Perfil</a></li>
          <li><a href="#simulador">Simulador</a></li>
          <li><a href="#aportaciones">Aportaciones</a></li>
          <li><a href="#proteccion">Protecci√≥n</a></li>
          <li><a href="#newsletter">Newsletter</a></li>
          <li><a href="#contacto">Contacto</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- CONTENIDO PRINCIPAL -->
  <main>
    <!-- Inicio -->
    <section id="inicio" class="hero">
      <div class="hero-content container">
        <h2>Bienvenido a tu libertad financiera</h2>
        <p>Asesor√≠a personalizada en ETFs, acciones y real estate para que tomes el control de tu dinero.</p>
        <a href="#newsletter" class="btn-primary">Suscr√≠bete al Newsletter</a>
      </div>
    </section>

    <!-- Qui√©n Soy -->
    <section id="quien-soy" class="section section-quien-soy">
      <div class="container qs-grid">
        <div class="qs-text">
          <h2>¬øQui√©n Soy?</h2>
          <p>Hola, soy <strong>Carlos</strong>, gestor patrimonial con m√°s de 10 a√±os de experiencia en inversi√≥n en ETFs, acciones y real estate. Mi misi√≥n es ense√±arte a gestionar tu dinero de forma inteligente y adaptada a tu perfil.</p>
          <p>Creo firmemente en la educaci√≥n financiera como herramienta de libertad, por eso acompa√±o a mis clientes en cada paso de su viaje inversor.</p>
          <a href="#asesorias" class="btn-primary">Conoce mis asesor√≠as</a>
        </div>
        <div class="qs-img">
          <img src="https://via.placeholder.com/400x400?text=Carlos" alt="Carlos, asesor financiero" />
        </div>
      </div>
    </section>

    <!-- Casos de √âxito -->
    <section id="casos-exito" class="section section-casos-exito">
      <div class="container">
        <h2>Casos de √âxito</h2>
        <div class="casos-grid">
          <div class="caso-card">
            <img src="https://via.placeholder.com/80?text=LG" alt="Laura G." />
            <h4>Laura G.</h4>
            <p>‚ÄúGracias a la asesor√≠a, logr√© ahorrar 200‚Ç¨ al mes y empec√© a invertir en ETFs. Ahora tengo m√°s tranquilidad y objetivos reales.‚Äù</p>
          </div>
          <div class="caso-card">
            <img src="https://via.placeholder.com/80?text=PM" alt="Pedro M." />
            <h4>Pedro M.</h4>
            <p>‚ÄúPas√© de no entender nada de inversiones a gestionar mi capital con confianza. Carlos me dio las herramientas justas y claras.‚Äù</p>
          </div>
          <div class="caso-card">
            <img src="https://via.placeholder.com/80?text=AJ" alt="Ana y Jorge" />
            <h4>Ana y Jorge</h4>
            <p>‚ÄúComo familia con ingresos bajos, no pens√°bamos que pod√≠amos invertir. Ahora tenemos un fondo com√∫n que crece cada mes.‚Äù</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Asesor√≠as -->
    <section id="asesorias" class="section section-asesorias">
      <div class="container asesorias-grid">
        <div class="asesorias-text">
          <h2>Asesor√≠as & Gesti√≥n de Inversiones</h2>
          <p>Ofrezco asesor√≠a estrat√©gica a inversores particulares, con o sin experiencia. Te acompa√±o en cada paso para dise√±ar una cartera adaptada a tus objetivos y tu nivel de riesgo.</p>
          <h3>üí° Suscripci√≥n mensual especial</h3>
          <p>Servicio dedicado a quienes ingresan menos de 1500 ‚Ç¨/mes o no tienen formaci√≥n financiera. Accede a asesoramiento real por una cuota asequible.</p>
          <div class="suscripcion-box">
            <p><strong>¬øIngresas menos de 1500 ‚Ç¨/mes?</strong> √önete a mi asesor√≠a accesible por solo <span class="highlight">9 ‚Ç¨/mes</span>.</p>
            <a href="#contacto" class="btn-primary">M√°s informaci√≥n</a>
          </div>
        </div>
        <div class="asesorias-img">
          <img src="https://via.placeholder.com/400x300?text=Asesor√≠as" alt="Asesor√≠as financieras" />
        </div>
      </div>
    </section>

    <!-- Modelos de Inversi√≥n -->
    <section id="modelos" class="section section-modelos">
      <div class="container">
        <h2>Modelos de Inversi√≥n</h2>
        <div class="modelos-cards">
          <div class="modelo-card">
            <img src="https://via.placeholder.com/80?text=ETFs" alt="Gesti√≥n de ETFs" />
            <h4>Gesti√≥n de ETFs</h4>
            <p>Diversifica tu cartera con fondos cotizados de bajo coste y exp√≥nte a mercados globales.</p>
          </div>
          <div class="modelo-card">
            <img src="https://via.placeholder.com/80?text=Acciones" alt="Inversi√≥n en Acciones" />
            <h4>Inversi√≥n en Acciones</h4>
            <p>Selecciona empresas de calidad para beneficiarte de su crecimiento a largo plazo.</p>
          </div>
          <div class="modelo-card">
            <img src="https://via.placeholder.com/80?text=Real+Estate" alt="Real Estate" />
            <h4>Real Estate</h4>
            <p>Accede al sector inmobiliario a trav√©s de REITs y plataformas de crowdlending.</p>
          </div>
          <div class="modelo-card">
            <img src="https://via.placeholder.com/80?text=Ahorro" alt="Planes de Ahorro" />
            <h4>Planes de Ahorro</h4>
            <p>Construye tu colch√≥n financiero con planes de jubilaci√≥n y productos de ahorro programado.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Test de Perfil Inversor (INLINE) -->
    <section id="test-perfil" class="section section-test">
    <div class="container">
      <h2>Test de Perfil Inversor</h2>
      <!-- Contador de pasos -->
      <div id="step-counter" class="step-counter">1 de 10</div>
  
      <form id="test-form">
        <!-- Paso 1 -->
        <div class="step active">
          <p>1. ¬øCu√°l es tu objetivo principal?</p>
          <label><input type="radio" name="q1" value="1" required> Seguridad</label>
          <label><input type="radio" name="q1" value="3"> Ingresos</label>
          <label><input type="radio" name="q1" value="5"> Crecimiento</label>
        </div>
        <!-- Paso 2 -->
        <div class="step">
          <p>2. ¬øHorizonte de inversi√≥n?</p>
          <label><input type="radio" name="q2" value="1" required> &lt; 1 a√±o</label>
          <label><input type="radio" name="q2" value="3"> 1‚Äì5 a√±os</label>
          <label><input type="radio" name="q2" value="5"> &gt; 5 a√±os</label>
        </div>
        <!-- Paso 3 -->
        <div class="step">
          <p>3. Reacci√≥n ante -10% de ca√≠da:</p>
          <label><input type="radio" name="q3" value="1" required> Vendo todo</label>
          <label><input type="radio" name="q3" value="3"> Espero</label>
          <label><input type="radio" name="q3" value="5"> Compro m√°s</label>
        </div>
        <!-- Paso 4 -->
        <div class="step">
          <p>4. % de patrimonio a invertir:</p>
          <label><input type="radio" name="q4" value="1" required> &lt; 20%</label>
          <label><input type="radio" name="q4" value="3"> 20‚Äì50%</label>
          <label><input type="radio" name="q4" value="5"> &gt; 50%</label>
        </div>
        <!-- Paso 5 -->
        <div class="step">
          <p>5. Nivel de conocimientos:</p>
          <label><input type="radio" name="q5" value="1" required> B√°sicos</label>
          <label><input type="radio" name="q5" value="3"> Intermedios</label>
          <label><input type="radio" name="q5" value="5"> Avanzados</label>
        </div>
        <!-- Paso 6 -->
        <div class="step">
          <p>6. ¬øNecesitas liquidez frecuente?</p>
          <label><input type="radio" name="q6" value="1" required> S√≠</label>
          <label><input type="radio" name="q6" value="3"> A veces</label>
          <label><input type="radio" name="q6" value="5"> No</label>
        </div>
        <!-- Paso 7 -->
        <div class="step">
          <p>7. ¬øCon qu√© frecuencia revisar√°s tus inversiones?</p>
          <label><input type="radio" name="q7" value="1" required> Diario</label>
          <label><input type="radio" name="q7" value="3"> Mensual</label>
          <label><input type="radio" name="q7" value="5"> Anual</label>
        </div>
        <!-- Paso 8 -->
        <div class="step">
          <p>8. ¬øComprendes bien el inter√©s compuesto?</p>
          <label><input type="radio" name="q8" value="1" required> No</label>
          <label><input type="radio" name="q8" value="3"> Algo</label>
          <label><input type="radio" name="q8" value="5"> S√≠</label>
        </div>
        <!-- Paso 9 -->
        <div class="step">
          <p>9. ¬øHas invertido antes?</p>
          <label><input type="radio" name="q9" value="1" required> Nunca</label>
          <label><input type="radio" name="q9" value="3"> Pocas veces</label>
          <label><input type="radio" name="q9" value="5"> Con frecuencia</label>
        </div>
        <!-- Paso 10 -->
        <div class="step">
          <p>10. ¬øTe afectan las noticias de mercado?</p>
          <label><input type="radio" name="q10" value="1" required> Mucho</label>
          <label><input type="radio" name="q10" value="3"> Algo</label>
          <label><input type="radio" name="q10" value="5"> Casi nada</label>
        </div>
  
        <div class="buttons">
          <button type="button" id="prev-btn" class="btn-primary" disabled>Anterior</button>
          <button type="button" id="next-btn" class="btn-primary">Siguiente</button>
        </div>
      </form>
  
      <div id="test-result" class="test-result" style="display:none;">
        <h3>Tu perfil de riesgo es: <span id="perfil-texto"></span></h3>
        <p id="perfil-desc"></p>
        <p>Rendimiento anual estimado: <strong id="perfil-return"></strong></p>
      </div>
    </div>
    </section>
  
<!-- Calculadora de Inter√©s Compuesto -->
<section id="compound-calc" class="section section-compound">
    <div class="container">
      <h2>Calculadora de Inter√©s Compuesto</h2>
  
      <!-- Inputs inline -->
      <div class="compound-inputs">
        <select id="calc-mode">
          <option value="savings">¬øCu√°nto puedo ahorrar?</option>
          <option value="growth">¬øCu√°nto tendr√° mi inversi√≥n?</option>
        </select>
  
        <label>
          Balance inicial (‚Ç¨)
          <input type="number" id="initialBalance" value="25000" min="0">
        </label>
  
        <label>
          Dep√≥sito peri√≥dico (‚Ç¨)
          <div class="inline-group">
            <input type="number" id="depositAmount" value="200" min="0">
            <select id="depositFreq">
              <option value="monthly">Mensual</option>
              <option value="yearly">Anual</option>
            </select>
          </div>
        </label>
  
        <label>
          Timing de dep√≥sito
          <select id="depositTiming">
            <option value="start">Al inicio del periodo</option>
            <option value="end">Al final del periodo</option>
          </select>
        </label>
  
        <label>
          Tasa anual (%)
          <input type="number" id="annualRate" value="6" step="0.1" min="0">
        </label>
  
        <label>
          Duraci√≥n (<span id="durationValue">10</span> a√±os)
          <input type="range" id="duration" min="1" max="50" value="10">
        </label>
  
        <button id="calcButton" class="btn-primary">Calcular</button>
      </div>
  
      <!-- Resultado oculto hasta calcular -->
      <div id="compoundResult" class="compound-result" style="display:none;">
        <h3 id="resultText"></h3>
        <div class="compound-charts">
          <canvas id="pieChart"></canvas>
          <canvas id="barChart"></canvas>
        </div>
        <div class="compound-table">
          <table id="resultTable">
            <thead>
              <tr>
                <th>A√±o</th>
                <th>Dep√≥sitos peri√≥dicos</th>
                <th>Dep√≥sitos totales</th>
                <th>Inter√©s total</th>
                <th>Balance</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>
  

    <!-- Protecci√≥n Patrimonial -->
    <section id="proteccion" class="section">
      <div class="container">
        <h2>Protecci√≥n Patrimonial</h2>
        <p>Plan de jubilaci√≥n, diversificaci√≥n y objetivos.</p>
      </div>
    </section>

    <!-- Newsletter -->
    <section id="newsletter" class="section">
      <div class="container">
        <h2>Newsletter</h2>
        <p>√önete para recibir contenidos exclusivos.</p>
      </div>
    </section>

    <!-- Contacto -->
    <section id="contacto" class="section">
      <div class="container">
        <h2>Contacto</h2>
        <p>Formulario y datos de contacto.</p>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer role="contentinfo">
    <div class="container">
      <p>&copy; 2025 Carlos Asesor Financiero. Todos los derechos reservados.</p>
    </div>
  </footer>

  <!-- Scripts generales -->
  <script>
    // Toggle men√∫ m√≥vil
    document.querySelector('.nav-toggle').onclick = () => {
      document.querySelector('nav ul').classList.toggle('show');
    };
  </script>

  <!-- Test de Perfil Inline -->
  <script>
    (function(){
      const steps       = Array.from(document.querySelectorAll('#test-perfil .step'));
      const prevBtn     = document.getElementById('prev-btn');
      const nextBtn     = document.getElementById('next-btn');
      const form        = document.getElementById('test-form');
      const result      = document.getElementById('test-result');
      const txt         = document.getElementById('perfil-texto');
      const desc        = document.getElementById('perfil-desc');
      const retElem     = document.getElementById('perfil-return');
      const counterElem = document.getElementById('step-counter');
      const total       = steps.length;
      let current       = 0;
    
      // Map de perfiles a rangos y tasas
      const map = {
        'Conservador': { range:'4‚Äì5%',   rate:4.5 },
        'Moderado':    { range:'7‚Äì8%',   rate:7.5 },
        'Agresivo':    { range:'10‚Äì12%', rate:11  }
      };
    
      function showStep(i) {
        steps.forEach((s, idx) => s.classList.toggle('active', idx === i));
        prevBtn.disabled          = i === 0;
        nextBtn.textContent       = i === total - 1 ? 'Terminar' : 'Siguiente';
        counterElem.textContent   = `${i+1} de ${total}`;
      }
    
      prevBtn.addEventListener('click', () => {
        if (current > 0) showStep(--current);
      });
    
      nextBtn.addEventListener('click', () => {
        const checked = [...steps[current].querySelectorAll('input')].some(i => i.checked);
        if (!checked) return alert('Selecciona una opci√≥n');
        if (current < total - 1) {
          showStep(++current);
        } else {
          // calculamos perfil
          const score = [...new FormData(form).values()]
                          .reduce((sum,v)=>sum+parseInt(v,10),0);
          let perfil;
          if (score <= 20)      perfil = 'Conservador';
          else if (score <= 35) perfil = 'Moderado';
          else                  perfil = 'Agresivo';
    
          // llenamos resultado
          const info = map[perfil];
          txt.textContent    = perfil;
          desc.textContent   = info.range==='4‚Äì5%' 
                              ? 'Buscas seguridad.' 
                              : (perfil==='Moderado'
                                  ? 'Aceptas volatilidad.' 
                                  : 'Asumes riesgo.');
          retElem.textContent = info.range;
          result.style.display = 'block';
          form.style.display   = 'none';
    
          // prefill simuladores
          const simRate = document.getElementById('tasa');
          if (simRate) simRate.value = info.rate;
          const simRateM = document.getElementById('tasa_m');
          if (simRateM) simRateM.value = info.rate;
    
          // hacemos scroll al simulador
          document.getElementById('simulador').scrollIntoView({ behavior:'smooth' });
        }
      });
    
      document.addEventListener('DOMContentLoaded', () => showStep(0));
    })();
  </script>
    
  <!-- Simulador de Inter√©s Compuesto -->
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('simulador-form');
    const ctx  = document.getElementById('simulador-chart').getContext('2d');
    let chart  = null;

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const P     = parseFloat(form.principal.value);
      const rA    = parseFloat(form.tasa.value) / 100;
      const n     = parseInt(form.a√±os.value, 10);
      const i     = parseFloat(form.inflacion.value) / 100;
      const t     = parseFloat(form.impuestos.value) / 100;
      const rNetA = rA * (1 - t);

      const labels           = [];
      const nominalData      = [];
      const realData         = [];
      const afterTaxData     = [];
      const realAfterTaxData = [];

      for (let year = 0; year <= n; year++) {
        labels.push(`A√±o ${year}`);
        const Vn  = P * Math.pow(1 + rA, year);
        nominalData.push(+Vn.toFixed(2));
        realData.push(+(Vn / Math.pow(1 + i, year)).toFixed(2));
        const Vat = P * Math.pow(1 + rNetA, year);
        afterTaxData.push(+Vat.toFixed(2));
        realAfterTaxData.push(+(Vat / Math.pow(1 + i, year)).toFixed(2));
      }

      const datasets = [
        { label: 'Nominal',             data: nominalData,      fill: false, tension: 0.3 },
        { label: 'Real (inflaci√≥n)',    data: realData,         fill: false, tension: 0.3 },
        { label: 'Neto tras impuestos', data: afterTaxData,     fill: false, tension: 0.3 },
        { label: 'Real neto (inf+imp)', data: realAfterTaxData, fill: false, tension: 0.3 }
      ];

      if (chart) {
        chart.data.labels   = labels;
        chart.data.datasets = datasets;
        chart.update();
      } else {
        chart = new Chart(ctx, {
          type: 'line',
          data: { labels, datasets },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { y: { beginAtZero: true } }
          }
        });
      }
    });
  });
  </script>

  <!-- Simulador con Aportaciones Mensuales -->
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const formM = document.getElementById('aportaciones-form');
    const ctxM  = document.getElementById('aportaciones-chart').getContext('2d');
    let chartM  = null;

    formM.addEventListener('submit', function(e) {
      e.preventDefault();
      const P      = parseFloat(formM.principal.value);
      const rA     = parseFloat(formM.tasa.value) / 100;
      const years  = parseInt(formM.a√±os.value, 10);
      const C      = parseFloat(formM.mensual.value);
      const i      = parseFloat(formM.inflacion.value) / 100;
      const t      = parseFloat(formM.impuestos.value) / 100;
      const rM     = rA / 12;
      const rNetA  = rA * (1 - t);
      const rNetM  = rNetA / 12;

      const labels       = [];
      const nominal      = [];
      const real         = [];
      const afterTax     = [];
      const realAfterTax = [];

      for (let y = 0; y <= years; y++) {
        const months = y * 12;
        labels.push(`A√±o ${y}`);

        const VnP = P * Math.pow(1 + rA, y);
        const VnC = months > 0
          ? C * ((Math.pow(1 + rM, months) - 1) / rM)
          : 0;
        const Vnom = VnP + VnC;
        nominal.push(+Vnom.toFixed(2));
        real.push(+(Vnom / Math.pow(1 + i, y)).toFixed(2));

        const VtP = P * Math.pow(1 + rNetA, y);
        const VtC = months > 0
          ? C * ((Math.pow(1 + rNetM, months) - 1) / rNetM)
          : 0;
        const Vtax = VtP + VtC;
        afterTax.push(+Vtax.toFixed(2));
        realAfterTax.push(+(Vtax / Math.pow(1 + i, y)).toFixed(2));
      }

      const datasetsM = [
        { label: 'Nominal',             data: nominal,      fill: false, tension: 0.3 },
        { label: 'Real (inflaci√≥n)',    data: real,         fill: false, tension: 0.3 },
        { label: 'Neto impuestos',      data: afterTax,     fill: false, tension: 0.3 },
        { label: 'Real neto (inf+imp)', data: realAfterTax, fill: false, tension: 0.3 }
      ];

      if (chartM) {
        chartM.data.labels   = labels;
        chartM.data.datasets = datasetsM;
        chartM.update();
      } else {
        chartM = new Chart(ctxM, {
          type: 'line',
          data: { labels, datasets: datasetsM },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { y: { beginAtZero: true } }
          }
        });
      }
    });
  });
  </script>
  <script>
    (function(){
      const steps       = Array.from(document.querySelectorAll('#test-perfil .step'));
      const prevBtn     = document.getElementById('prev-btn');
      const nextBtn     = document.getElementById('next-btn');
      const form        = document.getElementById('test-form');
      const result      = document.getElementById('test-result');
      const txt         = document.getElementById('perfil-texto');
      const desc        = document.getElementById('perfil-desc');
      const counterElem = document.getElementById('step-counter');
      const total       = steps.length;
      let current       = 0;
    
      function showStep(i) {
        steps.forEach((s, idx) => s.classList.toggle('active', idx === i));
        prevBtn.disabled = i === 0;
        nextBtn.textContent = i === total - 1 ? 'Terminar' : 'Siguiente';
        counterElem.textContent = `${i+1} de ${total}`;
      }
    
      prevBtn.addEventListener('click', () => {
        if (current > 0) showStep(--current);
      });
    
      nextBtn.addEventListener('click', () => {
        const checked = [...steps[current].querySelectorAll('input')].some(i => i.checked);
        if (!checked) return alert('Selecciona una opci√≥n');
        if (current < total - 1) {
          showStep(++current);
        } else {
          // Calcular perfil
          const score = [...new FormData(form).values()]
                          .reduce((sum,v)=>sum+parseInt(v,10), 0);
          let perfil, pd;
          if (score <= 20)      [perfil,pd]=['Conservador','Buscas seguridad.'];
          else if (score <= 35) [perfil,pd]=['Moderado','Aceptas volatilidad.'];
          else                  [perfil,pd]=['Agresivo','Asumes riesgo.'];
          txt.textContent    = perfil;
          desc.textContent   = pd;
          result.style.display = 'block';
          form.style.display   = 'none';
        }
      });
    
      document.addEventListener('DOMContentLoaded', () => showStep(0));
    })();
    </script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const modeEl    = document.getElementById('calc-mode');
      const initEl    = document.getElementById('initialBalance');
      const depAmtEl  = document.getElementById('depositAmount');
      const depFreqEl = document.getElementById('depositFreq');
      const depTimeEl = document.getElementById('depositTiming');
      const rateEl    = document.getElementById('annualRate');
      const durEl     = document.getElementById('duration');
      const durVal    = document.getElementById('durationValue');
      const btn       = document.getElementById('calcButton');
      const resultDiv = document.getElementById('compoundResult');
      const resultTxt = document.getElementById('resultText');
      const pieCtx    = document.getElementById('pieChart').getContext('2d');
      const barCtx    = document.getElementById('barChart').getContext('2d');
      const tableBody = document.querySelector('#resultTable tbody');
      let pieChart, barChart;
    
      // Actualiza el label del slider
      durEl.addEventListener('input', ()=> durVal.textContent = durEl.value);
    
      btn.addEventListener('click', ()=>{
        // Leer valores
        const P   = +initEl.value;
        const C   = +depAmtEl.value;
        const freq= depFreqEl.value;         // 'monthly' o 'yearly'
        const atStart = depTimeEl.value==='start';
        const r   = +rateEl.value/100;
        const yrs = +durEl.value;
        const nPeriods = (freq==='monthly'? yrs*12 : yrs);
        const periodRate = freq==='monthly'? r/12 : r;
    
        // Calcula balances a√±o a a√±o
        let balance = P;
        let totalDeps = 0;
        const labels = [];
        const depositsArr = [];
        const interestArr = [];
        const balanceArr  = [];
    
        for(let y=1; y<=yrs; y++){
          let yearDep = 0, yearInt = 0;
          if(freq==='monthly'){
            for(let m=1; m<=12; m++){
              if(atStart){
                balance += C;
                yearDep += C;
              }
              const interest = balance * periodRate;
              yearInt += interest;
              balance += interest;
              if(!atStart){
                balance += C;
                yearDep += C;
              }
            }
          } else {
            if(atStart){
              balance += C;
              yearDep += C;
            }
            const interest = balance * periodRate;
            yearInt += interest;
            balance += interest;
            if(!atStart){
              balance += C;
              yearDep += C;
            }
          }
          totalDeps += yearDep;
          labels.push(`A√±o ${y}`);
          depositsArr.push(yearDep);
          interestArr.push(yearInt);
          balanceArr.push(balance);
        }
    
        // Resultado texto
        if(modeEl.value==='savings'){
          resultTxt.textContent = 
            `Puedes ahorrar ${balance.toLocaleString()} ‚Ç¨ con ${C.toLocaleString()} ‚Ç¨ mensuales durante ${yrs} a√±os`;
        } else {
          resultTxt.textContent =
            `Tu inversi√≥n inicial de ${P.toLocaleString()} ‚Ç¨ crecer√° hasta ${balance.toLocaleString()} ‚Ç¨ en ${yrs} a√±os`;
        }
    
// ‚Ä¶dentro de tu listener de ‚ÄúCalcular‚Äù, tras haber calculado pieData, pieLabels, labels, depositsArr, interestArr, balanceArr‚Ä¶

// ‚îÄ‚îÄ‚îÄ Doughnut Chart con % inside ‚îÄ‚îÄ‚îÄ
if (pieChart) {
  pieChart.data.datasets[0].data = pieData;
  pieChart.update();
} else {
  pieChart = new Chart(pieCtx, {
    type: 'doughnut',
    data: {
      labels: pieLabels,
      datasets: [{
        data: pieData,
        backgroundColor: [
          'rgba(94,184,255,0.8)',
          'rgba(255,111,97,0.8)',
          'rgba(255,189,46,0.8)'
        ],
        borderColor: ['#fff','#fff','#fff'],
        borderWidth: 2,
        cutout: '50%'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'bottom' },
        datalabels: {
          color: '#fff',
          formatter: (value, ctx) => {
            const sum = ctx.chart.data.datasets[0].data.reduce((a,b)=>a+b,0);
            return (value / sum * 100).toFixed(1) + '%';
          }
        },
        tooltip: {
          callbacks: {
            label: ctx => `${ctx.label}: ${ctx.parsed} ‚Ç¨`
          }
        }
      }
    },
    plugins: [ChartDataLabels]
  });
}

// ‚îÄ‚îÄ‚îÄ Line/Area Chart para evoluci√≥n ‚îÄ‚îÄ‚îÄ
if (barChart) {
  barChart.data.labels   = labels;
  barChart.data.datasets = [
    {
      label: 'Balance total',
      data: balanceArr,
      fill: true,
      backgroundColor: 'rgba(94,184,255,0.3)',
      borderColor: 'rgba(94,184,255,1)',
      tension: 0.4,
      pointRadius: 3
    },
    {
      label: 'Dep√≥sitos peri√≥dicos',
      data: depositsArr,
      fill: false,
      borderColor: 'rgba(255,111,97,1)',
      tension: 0.3
    },
    {
      label: 'Inter√©s generado',
      data: interestArr,
      fill: false,
      borderColor: 'rgba(255,189,46,1)',
      borderDash: [5,5],
      tension: 0.3
    }
  ];
  barChart.update();
} else {
  barChart = new Chart(barCtx, {
    type: 'line',
    data: {
      labels,
      datasets: [
        {
          label: 'Balance total',
          data: balanceArr,
          fill: true,
          backgroundColor: 'rgba(94,184,255,0.3)',
          borderColor: 'rgba(94,184,255,1)',
          tension: 0.4,
          pointRadius: 3
        },
        {
          label: 'Dep√≥sitos peri√≥dicos',
          data: depositsArr,
          fill: false,
          borderColor: 'rgba(255,111,97,1)',
          tension: 0.3
        },
        {
          label: 'Inter√©s generado',
          data: interestArr,
          fill: false,
          borderColor: 'rgba(255,189,46,1)',
          borderDash: [5,5],
          tension: 0.3
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'top' },
        tooltip: {
          callbacks: {
            label: ctx => `${ctx.dataset.label}: ${ctx.parsed.y.toLocaleString()} ‚Ç¨`
          }
        }
      },
      scales: {
        x: {
          title: { display: true, text: 'A√±o' }
        },
        y: {
          beginAtZero: true,
          ticks: { callback: v => v.toLocaleString() }
        }
      }
    },
    plugins: [ChartDataLabels]
  });
}

    
        // Tabla
        tableBody.innerHTML = '';
        for(let i=0;i<yrs;i++){
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${i+1}</td>
            <td>${depositsArr[i].toLocaleString()}</td>
            <td>${(P + depositsArr.slice(0,i+1).reduce((a,b)=>a+b,0)).toLocaleString()}</td>
            <td>${interestArr[i].toLocaleString()}</td>
            <td>${balanceArr[i].toLocaleString()}</td>
          `;
          tableBody.appendChild(tr);
        }
    
        // Mostrar secci√≥n
        resultDiv.style.display = 'block';
        resultDiv.scrollIntoView({behavior:'smooth'});
      });
    });
    </script>
      
</body>
</html>
